# Simulador de Pr√©stamos Amortizables COF_ES

![Python](https://img.shields.io/badge/Python-3.8%2B-blue) ![Streamlit](https://img.shields.io/badge/Framework-Streamlit-brightgreen)

Aplicaci√≥n desarrollada en **Streamlit** para simular operaciones de productos amortizables de COF_ES. Permite configurar las condiciones de un pr√©stamo, visualizar el cuadro de amortizaci√≥n, el c√°lculo de la TAE y obtener un ejemplo representativo del producto seleccionado.

---

## Estructura del Proyecto

- **app_simulador_CLB.py**  
  Archivo principal de la aplicaci√≥n Streamlit. Gestiona la interfaz de usuario, la entrada de datos y la visualizaci√≥n de resultados.

- **COFES\_\_SIM_AMO_Consola.py**  
  M√≥dulo con la l√≥gica de simulaci√≥n y c√°lculo de pr√©stamos, generaci√≥n de cuadros de amortizaci√≥n y c√°lculo de TAE.

- **COFES_00_PRODUCTOS_DICCIONARIO.csv**  
  Fichero con el diccionario con el listado de productos y sus caracter√≠sticas.

- **COFES_01_Date_Blocage.csv**  
  Fichero con el listado de fechas de bloqueo (date de blocage).

---

## üöÄ Instalaci√≥n

```bash
# Instala dependencias
pip install streamlit pandas
```

Coloca los archivos en una carpeta y ejecuta la aplicaci√≥n:

```bash
# Ejecuta la aplicaci√≥n
streamlit run app_simulador_CLB.py
```

---

## üìù Uso

1. Selecciona el producto de cr√©dito en la barra lateral.
2. Personaliza fechas, importe, plazo, tipo de inter√©s y otros par√°metros.
3. Configura el seguro y la comisi√≥n de apertura si el producto lo permite.
4. Para productos con segunda secuencia financiera, activa la opci√≥n y configura los valores.
5. Visualiza los resultados en las pesta√±as:
   - **Secuencias financieras**: Resumen de vencimientos y cuotas.
   - **Ejemplo representativo**: Texto explicativo del pr√©stamo simulado.
   - **Cuadro de amortizaci√≥n**: Detalle mensual de pagos, intereses y capital.
   - **Detalle TAE**: C√°lculo de la TAE y VAN.

---

## üõ†Ô∏è Principales Funcionalidades

| Funcionalidad           | Descripci√≥n                             |
| ----------------------- | --------------------------------------- |
| Simulaci√≥n de pr√©stamos | Diferentes productos y condiciones      |
| C√°lculo autom√°tico      | Cuotas, intereses, comisiones y seguros |
| Visualizaci√≥n           | Cuadros de amortizaci√≥n y TAE           |
| Ejemplo representativo  | Informaci√≥n clara para el cliente       |
| Interfaz interactiva    | Personalizaci√≥n de par√°metros           |

---

## üì¶ Dependencias

- [Streamlit](https://streamlit.io/)
- [Pandas](https://pandas.pydata.org/)

---

## üé® Personalizaci√≥n

Puedes modificar los productos, seguros y par√°metros en el m√≥dulo `COFES__SIM_AMO_Consola.py` para adaptarlo a nuevas ofertas o condiciones.

---

### üë• Contribuyentes

<img src="https://github.com/fjhidalgo-coding.png" width="24" height="24"> [fjhidalgo-coding](https://github.com/fjhidalgo-coding)

---

### ü§ù C√≥mo contribuir

1.  Crea un issue en este repositorio explicando la propuesta de cambio.
2.  Haz un fork del repositorio.
3.  Crea una nueva rama (`git checkout -b feature/AmazingFeature`).
4.  Haz tus cambios y haz el commit (`git commit -m 'Add some AmazingFeature'`).
5.  Sube tus cambios a la rama (`git push origin feature/AmazingFeature`).
6.  Abre un Pull Request en este repositorio.

---

## Changelog

### v0.9 (2025-10-17)

**Mejoras implementadas:**

- Refactorizaci√≥n en Python + Streamlit (publicaci√≥n en [Cloud Streamlit](https://cofes-app-simulador-clb.streamlit.app/)).
- A√±adir posibilidad de Option+ con segunda secuencia % respecto al financiado.
- Generar autom√°ticamente las frase de los pies legales.

**Fixed bugs:**

- El c√°lculo de la TAE --> Error en las CAP capitalizadas.
- El c√°lculo de la prima de seguro AUTO NO debe redondear en el paso final de los c√°lculos sino en el c√°lculo de la prima por asegurado.
- Error en los intereses cuando el contrato tiene carencia ya que duplicamos el contador al contabilidad los intereses capitalizados.
- Cuando seleccionamos el producto OPTION+ gratuito, el simulador no aplica inter√©s en la segunda secuencia.
- Error c√°lculo fecha primer vencimiento en CFUSION forzando un m√≠nimo de 14 d√≠as desde la financiaci√≥n.
- Error c√°lculo prima de seguro de CFUSION cuando la fecha de financiaci√≥n corresponde a un d√≠a de pago.

**Closed issues:**

- Comprobar que calculamos el descuento partner con las reglas facilitadas en el SA52221677.
- Modificamos el l√≠mite m√°ximo de CAP a 500,00‚Ç¨ (antes 90,00‚Ç¨).
- Supresi√≥n del suelo en las comisiones de apertura.
- Date de blocage del a√±o 2024 (SA52299989).
- Date de blocage del a√±o 2025 (SA56843696).
- Date de blocage del a√±o 2026.

### v0.6.1 (2022-12-27)

**Closed issues:**

- Date de blocage del a√±o 2023.

### v0.6 (2022-02-28)

**Mejoras implementadas:**

- Adaptaci√≥n del c√°lculo de la prima de seguro al proyecto ADE2T (2 asegurados en CPROYECTO y CFUSION con bonificaci√≥n de la prima).
- Adaptaci√≥n a la recapitalizaci√≥n (forzada) de la comisi√≥n de apertura partners (PTPA0143).
- Permitir rec√°lculos de financiaciones de hasta 360 mensualidades.

### v0.5.2 (2021-11-03)

**Fixed bugs:**

- Correcci√≥n en el c√≥mputo de d√≠as del c√°lculo de la TAE para los vencimientos cuya fecha valor es la fecha de financiaci√≥n (TAE mal simulada en los meses de enero posteriores a un a√±o bisiesto).

### v0.5.1 (2021-09-20)

**Fixed bugs:**

- C√°lculo correcto de la prima de seguro del periodo de carencia para CFUSION + CPROYECTO (SA45573947).

### v0.5 (2021-05-18)

**Mejoras implementadas:**

- Refactorizaci√≥n del simulador.
- Nueva configuraci√≥n de productos que facilita la adaptaci√≥n a los nuevos productos amortizables.
- Adaptaci√≥n al Cr√©dito Fusi√≥n.
- Adaptaci√≥n al Cr√©dito AUTO.
- Adaptaci√≥n al Vorwerk Option Plus.
- C√°lculo autom√°tico de las fechas ADC-1 y ADC+1.
- C√°lculo masivos de simulaciones de cr√©dito.
- A√±adir campo de Importe M√≠nimo / M√°ximo de la CA (en c√°lculo masivo + individual forzado + parametrizaci√≥n).
- Recapitalizaci√≥n de la comisi√≥n de apertura y c√°lculo de la cuota con comisi√≥n de apertura recapitalizada.

**Fixed bugs:**

- C√°lculo de intereses incorrecto en el primer vencimiento tras una carencia en los productos Vorwerk.
- C√°lculo correcto de la fecha del primer recibo de CFUSION + CPROYECTO (sin carencia).
- Correcci√≥n redondeo aplicado en el c√°lculo de la mensualidad de un contrato Anivestreno / Vorwerk Option Plus.

**Closed issues:**

- Date de blocage del a√±o 2020.
- Date de blocage del a√±o 2021.
- Date de blocage del a√±o 2022.

### v0.4 (2020-05-19)

**Mejoras implementadas:**

- Inclusi√≥n del seguro en la cuota TAE cuando √©ste sea obligatorio.

### v0.3.3 (2018-06-25)

**Closed issues:**

- Date de blocage del a√±o 2019.

### v0.3.2 (2017-12-22)

**Mejoras implementadas:**

- Mejora l√≥gica asociada al c√°lculo de los intereses y seguros ordinarios con la finalidad de simplificarla.

**Fixed bugs:**

- Seg√∫n SA34319500, los intereses (¬øy seguro?) de carencia a recapitalizar se calculan mes a mes redonde√°ndolos.

### v0.3.1 (2017-12-18)

**Fixed bugs:**

- Correcci√≥n en la validaci√≥n asociada al campo "F_Blocage posterior a la financiaci√≥n" ya que no estaba validando la fecha ADC de la colecci√≥n correspondiente.
- Control TIN 0,00% Partner.

### v0.3 (2017-12-05)

**Mejoras implementadas:**

- Calcular el descuento de los productos gratuitos.
- En funci√≥n de una "configuraci√≥n" asociada al producto, calcular la CAP truncada o redondeada.
- Mejora en la prioridad de alertas informativas. La alerta asociada a la TAE debe tener m√°s prioridad.
- Validaci√≥n de las fechas de ADC con una lista coleccionable.

**Fixed bugs:**

- C√°lculo de los intereses del 1er vencimiento cuando financiaci√≥n = fecha √©ch√©ance se calcula por d√≠as naturales en lugar de por periodos.
- Para los productos Vorwerk no se puede calcular diff√©r√©s ya que aumentar√≠a el importe de la primera mensualidad.

### v0.2 (2017-11-26)

**Mejoras implementadas:**

- Adaptaci√≥n del simulador a los productos con cuota discontinua con comisi√≥n de apertura.
- C√°lculo autom√°tico de la TAE con una macro.

**Fixed bugs:**

- Ajuste √∫ltima cuota ordinaria forzando el vencimiento de todo el capital disminuyendo el inter√©s devengado.
- Ajuste √∫ltima cuota "leasing" forzando el vencimiento de todo el capital disminuyendo el inter√©s devengado.
- Redondeado del valor residual cuando √©ste es calculado con un porcentaje.

### v0.1 (2017-10-16)

**Mejoras implementadas:**

- Versi√≥n inicial del simulador en excel para los productos con cuota discontinua ("leasing").
- Simulador de cuotas y de cuadros de amortizaci√≥n.
- C√°lculo de los vencimientos de carencia normal y carencia diferida.

---

**Nota:**  
Este simulador es una herramienta para comprobar los c√°lculos del sistema y no constituye una oferta vinculante. Los resultados pueden variar seg√∫n las condiciones reales del contrato.

---
